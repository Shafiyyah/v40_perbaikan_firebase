
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Monitoring Tunnel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/data.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(to right, #f0f4f8, #d9e2ec);
      margin: 0;
      padding: 0px;
      color: #333;
    }

    header {
      background-color: #2f80ed;
      color: white;
      padding: 30px 0;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    h2 { margin: 0; font-size: 24px; }
    main { max-width: 1200px; margin: auto; }

    .chart-container {
      margin-top: 30px;
      margin-bottom: 30px;
    }

    .chart-box {
      width: 100%;
      height: 400px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 00px;
    }

    footer {
      text-align: center;
      padding: 15px;
      color: #777;
      font-size: 14px;
    }

    form, .control-section {
      margin: 20px 0;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1);
      justify-content: center;
      align-items: center;
    }

    input, button, select {
      padding: 8px;
      margin: 5px;
      font-size: 14px;
    }

    hr { margin-top: 20px; margin-bottom: 20px; }

.heater-row {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: center;
  margin: 20px auto;
}

.heater-card {
  flex: 1 1 300px; /* fleksibel min 300px */
  max-width: 380px;
  background: #fff;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 1px 5px rgba(0,0,0,0.1);
  text-align: center;
  box-sizing: border-box;
}

.highcharts-contextmenu {
  max-height: 200px !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  z-index: 9999 !important;
}








  </style>
</head>
<body>
  <header>
    <h2>Monitoring Tunnel</h2>
  </header>

  <main>
    <div class="chart-container"><div id="chart-Temperature" class="chart-box"></div></div>
    <div class="chart-container"><div id="chart-PID" class="chart-box"></div></div>

    <div class="heater-row">
      <!-- Heater 1 -->
      <div class="heater-card">
        <h3>Heater 1</h3>
        <p><b>Set Max Fan Power:</b></p>
        <form action="/get">
          <input type="number" name="In_Power_Tunnel1" placeholder="Input Max Fan Power">
          <input type="submit" value="Submit">
        </form>
        <p>MAX Power = <span id="Max_Power_Tunnel1">0</span> %</p>
        <hr>

        <p><b>Set Max PID Heater Power:</b></p>
        <form action="/get">
          <input type="number" name="In_PID_Tunnel1" placeholder="Input Max PID Heater Power">
          <input type="submit" value="Submit">
        </form>
        <p>MAX Power = <span id="Max_PID_Tunnel1">0</span> %</p>
        <hr>

        <p><b>Set Tunnel Temperature (PID):</b></p>
        <form action="/get">
          <input type="number" name="In_Suhu_Tunnel1" placeholder="Input Suhu Tunnel">
          <input type="submit" value="Submit">
        </form>
        <p>Temperature = <span id="Suhu_Tunnel1">0</span> °C</p>
        <hr>
        <p><b>Fan Safety:</b></p>
        <form action="/get">
          <select name="In_Heat_st1">
            <option value="1">ON</option>
            <option value="0">OFF</option>
          </select>
          <input type="submit" value="Submit">
        </form>
        <p>Fan = <span id="Heat_st1">-</span></p>
        <hr>
        <p><b>Fan Power:</b></p>
        <form action="/get">
          <label for="In_Fan_Power1">Fan :</label>
          <select name="In_Fan_Power1" id="In_Fan_Power1">
            <option value="1">Max</option>
            <option value="0">OFF</option>
          </select>
          <input type="submit" value="Submit">
        </form>
        <p>Fan = <span id="Fan_Power1">-</span></p>
        <hr>
        <p><b>Set Heater Power:</b></p>
        <p>Status Fan: <span id="Fan_Status1">-</span></p> <!-- Tambahan -->
        <p>Power = <span id="Power_Tunnel1">0</span> %</p>
        <hr>
        <p>Input Set Point</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_sp1" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="SetPointSpan1">1.00000</span></p>
        <hr>
        <p>Input KP</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_kp1" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="Nilai_KP1">1.00000</span></p>
        <hr>
        <p>Input KI</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_ki1" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="Nilai_KI1">1.00000</span></p>
        <hr>
        <p>Input KD</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_kd1" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="Nilai_KD1">1.00000</span></p>
        <hr>
        <p>Hasil PID</p>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Max Pulse = <span id="Max_Power_Tunnel1">1.00000</span></p>
        <p>Output PID = <span id="Nilai_PID1">1.00000</span></p>
        <hr>
        <p><b>Set Kalibrasi Suhu Dinding 1:</b></p>
        <p>Temperature = <span id="DindSuhu1">0</span>  °C</p>

        <p>Input Kalibrasi Sensor BME280 Dinding 1</p>
        <p> y = mx + b</p>
        <form action="/get">
          <input type="number" name="In_CalM_DinD1" step="0.00001" placeholder="Input M">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          <input type="number" name="In_CalB_DinD1" step="0.00001" placeholder="Input B">
          <input type="submit" value="Submit">
        </form>
        <p>Nilai M = <span id="CalM_DinD1">1.00000</span>, Nilai B = <span id="CalB_DinD1">0.00000</span></p>
        

      </div>
      
      <!-- Heater 2 -->
      <div class="heater-card">
        <h3>Heater 2</h3>
        <p><b>Set Max Fan Power:</b></p>
        <form action="/get">
          <input type="number" name="In_Power_Tunnel2" placeholder="Input Max Fan Power">
          <input type="submit" value="Submit">
        </form>
        <p>MAX Power = <span id="Max_Power_Tunnel2">0</span> %</p>
        <hr>

        <p><b>Set Max PID Heater Power:</b></p>
        <form action="/get">
          <input type="number" name="In_PID_Tunnel2" placeholder="Input Max PID Heater Power">
          <input type="submit" value="Submit">
        </form>
        <p>MAX Power = <span id="Max_PID_Tunnel2">0</span> %</p>
        <hr>


        <p><b>Set Tunnel Temperature (PID):</b></p>
        <form action="/get">
          <input type="number" name="In_Suhu_Tunnel2" placeholder="Input Suhu Tunnel">
          <input type="submit" value="Submit">
        </form>
        <p>Temperature = <span id="Suhu_Tunnel2">0</span> °C</p>
        <hr>
        <p><b>Fan Safety:</b></p>
        <form action="/get">
          <select name="In_Heat_st2">
            <option value="1">ON</option>
            <option value="0">OFF</option>
          </select>
          <input type="submit" value="Submit">
        </form>
        <p>Fan = <span id="Heat_st2">-</span></p>
        <hr>
        <p><b>Fan Power:</b></p>
        <form action="/get">
          <label for="In_Fan_Power2">Fan :</label>
          <select name="In_Fan_Power2" id="In_Fan_Power2">
            <option value="1">Max</option>
            <option value="0">OFF</option>
          </select>
          <input type="submit" value="Submit">
        </form>
        <p>Fan = <span id="Fan_Power2">-</span></p>
        <hr>
        <p><b>Set Heater Power:</b></p>
        <p>Status Fan: <span id="Fan_Status2">-</span></p> <!-- Tambahan -->
        <!-- <form action="/get">
          <input type="number" name="In_Power_Tunnel2" placeholder="Input Power Heater">
          <input type="submit" value="Submit">
        </form> -->
        <p>Power = <span id="Power_Tunnel2">0</span> %</p>
        <hr>
        <p>Input Set Point</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_sp2" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="SetPointSpan2">1.00000</span></p>
        <hr>
        <p>Input KP</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_kp2" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="Nilai_KP2">1.00000</span></p>
        <hr>
        <p>Input KI</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_ki2" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="Nilai_KI2">1.00000</span></p>
        <hr>
        <p>Input KD</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_kd2" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="Nilai_KD2">1.00000</span></p>
        <hr>
        <p>Hasil PID</p>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Max Pulse = <span id="Max_Power_Tunnel2">1.00000</span></p>
        <p>Output PID = <span id="Nilai_PID2">1.00000</span></p>
        <hr>
        <p><b>Set Kalibrasi Suhu Dinding 2:</b></p>
        <p>Temperature = <span id="DindSuhu2">0</span>  °C</p>
        <p>Input Kalibrasi Sensor BME280 Dinding 1</p>
        <p> y = mx + b</p>
        <form action="/get">
          <input type="number" name="In_CalM_DinD2" step="0.00001" placeholder="Input M">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          <input type="number" name="In_CalB_DinD2" step="0.00001" placeholder="Input B">
          <input type="submit" value="Submit">
        </form>
        <p>Nilai M = <span id="CalM_DinD2">1.00000</span>, Nilai B = <span id="CalB_DinD2">0.00000</span></p>

      </div>
    
      <!-- Heater 3 -->
      <div class="heater-card">
        <h3>Heater 3</h3>
        <p><b>Set Max Fan Power:</b></p>
        <form action="/get">
          <input type="number" name="In_Power_Tunnel3" placeholder="Input Max Fan Power">
          <input type="submit" value="Submit">
        </form>
        <p>MAX Power = <span id="Max_Power_Tunnel3">0</span> %</p>
        <hr>

        <p><b>Set Max PID Heater Power:</b></p>
        <form action="/get">
          <input type="number" name="In_PID_Tunnel3" placeholder="Input Max PID Heater Power">
          <input type="submit" value="Submit">
        </form>
        <p>MAX Power = <span id="Max_PID_Tunnel3">0</span> %</p>
        <hr>

        
        <p><b>Set Tunnel Temperature (PID):</b></p>
        <form action="/get">
          <input type="number" name="In_Suhu_Tunnel3" placeholder="Input Suhu Tunnel">
          <input type="submit" value="Submit">
        </form>
        <p>Temperature = <span id="Suhu_Tunnel3">0</span> °C</p>
        <hr>
        <p><b>Fan Safety:</b></p>
        <form action="/get">
          <select name="In_Heat_st3">
            <option value="1">ON</option>
            <option value="0">OFF</option>
          </select>
          <input type="submit" value="Submit">
        </form>
        <p>Fan = <span id="Heat_st3">-</span></p>
        <hr>
        <p><b>Fan Power:</b></p>
        <form action="/get">
          <label for="In_Fan_Power3">Fan :</label>
          <select name="In_Fan_Power3" id="In_Fan_Power3">
            <option value="1">Max</option>
            <option value="0">OFF</option>
          </select>
          <input type="submit" value="Submit">
        </form>
        <p>Fan = <span id="Fan_Power3">-</span></p>
        <hr>
        <p><b>Set Heater Power:</b></p>
        <p>Status Fan: <span id="Fan_Status3">-</span></p> <!-- Tambahan -->
        <!-- <form action="/get">
          <input type="number" name="In_Power_Tunnel3" placeholder="Input Power Heater">
          <input type="submit" value="Submit">
        </form> -->
        <p>Power = <span id="Power_Tunnel3">0</span> %</p>
        <hr>
        <p>Input Set Point</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_sp3" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="SetPointSpan3">1.00000</span></p>
        <hr>
        <p>Input KP</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_kp3" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="Nilai_KP3">1.00000</span></p>
        <hr>
        <p>Input KI</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_ki3" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="Nilai_KI3">1.00000</span></p>
        <hr>
        <p>Input KD</p>
            <form action="/get" target="hidden-form">
            <input type="number" name="In_kd3" step="0.00001" placeholder="Input nilai Kalibrasi ">
            <input type="submit" value="Submit">
            </form>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Nilai = <span id="Nilai_KD3">1.00000</span></p>
        <hr>
        <p>Hasil PID</p>
            <iframe style="display: none;" name="hidden-form"></iframe>
        <p>Max Pulse = <span id="Max_Power_Tunnel3">1.00000</span></p>
        <p>Output PID = <span id="Nilai_PID3">1.00000</span></p>
        <hr>
        <p><b>Set Kalibrasi Suhu Dinding 3:</b></p>
        <p>Temperature = <span id="DindSuhu3">0</span>  °C</p>
        <p>Input Kalibrasi Sensor BME280 Dinding 1</p>
        <p> y = mx + b</p>
        <form action="/get">
          <input type="number" name="In_CalM_DinD3" step="0.00001" placeholder="Input M">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          <input type="number" name="In_CalB_DinD3" step="0.00001" placeholder="Input B">
          <input type="submit" value="Submit">
        </form>
        <p>Nilai M = <span id="CalM_DinD3">1.00000</span>, Nilai B = <span id="CalB_DinD3">0.00000</span></p>

      </div>
    </div>
    

    <!-- Form Kontrol dan Kalibrasi -->
    <div style="text-align: center; max-width: 500px; margin: 0 auto;">

      <!-- <div class="control-section">

        <p><b>BME280 Callibration:</b></p>
        <p>Temperature = <span id="DindSuhu1">0</span>  °C</p>

        <p>Input Kalibrasi Sensor BME280 Dinding 1 (y = mx + b)</p>
        <form action="/get">
          <input type="number" name="In_CalM_DinD1" step="0.00001" placeholder="Input M">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          <input type="number" name="In_CalB_DinD1" step="0.00001" placeholder="Input B">
          <input type="submit" value="Submit">
        </form>
        <p>Nilai M = <span id="CalM_DinD1">1.00000</span>, Nilai B = <span id="CalB_DinD1">0.00000</span></p>

        <hr>
        <p>Temperature = <span id="DindSuhu2">0</span>  °C</p>
        <p>Input Kalibrasi Sensor BME280 Dinding 2 (y = mx + b)</p>
        <form action="/get">
          <input type="number" name="In_CalM_DinD2" step="0.00001" placeholder="Input M">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          <input type="number" name="In_CalB_DinD2" step="0.00001" placeholder="Input B">
          <input type="submit" value="Submit">
        </form>
        <p>Nilai M = <span id="CalM_DinD2">1.00000</span>, Nilai B = <span id="CalB_DinD2">0.00000</span></p>

        <hr>
        <p>Temperature = <span id="DindSuhu3">0</span>  °C</p>
        <p>Input Kalibrasi Sensor BME280 Dinding 3 (y = mx + b)</p>
        <form action="/get">
          <input type="number" name="In_CalM_DinD3" step="0.00001" placeholder="Input M">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          <input type="number" name="In_CalB_DinD3" step="0.00001" placeholder="Input B">
          <input type="submit" value="Submit">
        </form>
        <p>Nilai M = <span id="CalM_DinD3">1.00000</span>, Nilai B = <span id="CalB_DinD3">0.00000</span></p>

      </div> -->

      <div style="text-align: center; max-width: 800px; margin: 0 auto;">
        <div class="control-section">
          <p><b>Arus WCS1700 1:</b></p>
          <p>Arus = <span id="Arus1">0</span> A</p>
          <p>Input Kalibrasi Sensor WCS1700 (y = mx + b)</p>
          <form action="/get">
            <input type="number" name="In_CalM_Wcs1" step="0.00001" placeholder="Input M">
            <input type="submit" value="Submit">
          </form>
          <form action="/get">
            <input type="number" name="In_CalB_Wcs1" step="0.00001" placeholder="Input B">
            <input type="submit" value="Submit">
          </form>
          <p>Nilai M = <span id="CalM_Wcs1">1.00000</span>, Nilai B = <span id="CalB_Wcs1">0.00000</span></p>
          <hr>
          <p><b>Input PID :</b></p>
          <p>KP</p>
          <form action="/get">
            <input type="number" name="In_kpFan1" step="0.00001" placeholder="Input KP">
            <input type="submit" value="Submit">
          </form>
          <p>KI</p>
          <form action="/get">
            <input type="number" name="In_kiFan1" step="0.00001" placeholder="Input KI">
            <input type="submit" value="Submit">
          </form>
          <p>KD</p>
          <form action="/get">
            <input type="number" name="In_kdFan1" step="0.00001" placeholder="Input KD">
            <input type="submit" value="Submit">
          </form>
          <p>Nilai KP = <span id="kpFan1">1.00000</span>, Nilai KI = <span id="kiFan1">0.00000</span>, Nilai KD = <span id="kdFan1">0.00000</span></p>
        </div>
  
        <div class="control-section">
          <p><b>Arus WCS1700 2:</b></p>
          <p>Arus = <span id="Arus2">0</span> A</p>
          <p>Input Kalibrasi Sensor WCS1700 (y = mx + b)</p>
          <form action="/get">
            <input type="number" name="In_CalM_Wcs2" step="0.00001" placeholder="Input M">
            <input type="submit" value="Submit">
          </form>
          <form action="/get">
            <input type="number" name="In_CalB_Wcs2" step="0.00001" placeholder="Input B">
            <input type="submit" value="Submit">
          </form>
          <p>Nilai M = <span id="CalM_Wcs2">1.00000</span>, Nilai B = <span id="CalB_Wcs2">0.00000</span></p>
          <hr>
          <p><b>Input PID :</b></p>
          <p>KP</p>
          <form action="/get">
            <input type="number" name="In_kpFan2" step="0.00001" placeholder="Input KP">
            <input type="submit" value="Submit">
          </form>
          <p>KI</p>
          <form action="/get">
            <input type="number" name="In_kiFan2" step="0.00001" placeholder="Input KI">
            <input type="submit" value="Submit">
          </form>
          <p>KD</p>
          <form action="/get">
            <input type="number" name="In_kdFan2" step="0.00001" placeholder="Input KD">
            <input type="submit" value="Submit">
          </form>
          <p>Nilai KP = <span id="kpFan2">1.00000</span>, Nilai KI = <span id="kiFan2">0.00000</span>, Nilai KD = <span id="kdFan2">0.00000</span></p>
        </div>
  
        <!-- <div class="control-section">
          <p><b>Arus WCS1700 3:</b></p>
          <p>Arus = <span id="Arus3">0</span> A</p>
          <p>Input Kalibrasi Sensor WCS1700 (y = mx + b)</p>
          <form action="/get">
            <input type="number" name="In_CalM_Wcs3" step="0.00001" placeholder="Input M">
            <input type="submit" value="Submit">
          </form>
          <form action="/get">
            <input type="number" name="In_CalB_Wcs3" step="0.00001" placeholder="Input B">
            <input type="submit" value="Submit">
          </form>
          <p>Nilai M = <span id="CalM_Wcs3">1.00000</span>, Nilai B = <span id="CalB_Wcs3">0.00000</span></p>
          <hr>
          <p><b>Input PID :</b></p>
          <p>KP</p>
          <form action="/get">
            <input type="number" name="In_kpFan3" step="0.00001" placeholder="Input KP">
            <input type="submit" value="Submit">
          </form>
          <p>KI</p>
          <form action="/get">
            <input type="number" name="In_kiFan3" step="0.00001" placeholder="Input KI">
            <input type="submit" value="Submit">
          </form>
          <p>KD</p>
          <form action="/get">
            <input type="number" name="In_kdFan3" step="0.00001" placeholder="Input KD">
            <input type="submit" value="Submit">
          </form>
          <p>Nilai KP = <span id="kpFan3">1.00000</span>, Nilai KI = <span id="kiFan3">0.00000</span>, Nilai KD = <span id="kdFan3">0.00000</span></p>
        </div>
  
        <div class="control-section">
          <p><b>Arus WCS1700 4:</b></p>
          <p>Arus = <span id="Arus4">0</span> A</p>
          <p>Input Kalibrasi Sensor WCS1700 (y = mx + b)</p>
          <form action="/get">
            <input type="number" name="In_CalM_Wcs4" step="0.00001" placeholder="Input M">
            <input type="submit" value="Submit">
          </form>
          <form action="/get">
            <input type="number" name="In_CalB_Wcs4" step="0.00001" placeholder="Input B">
            <input type="submit" value="Submit">
          </form>
          <p>Nilai M = <span id="CalM_Wcs4">1.00000</span>, Nilai B = <span id="CalB_Wcs4">0.00000</span></p>
          <hr>
          <p><b>Input PID :</b></p>
          <p>KP</p>
          <form action="/get">
            <input type="number" name="In_kpFan4" step="0.00001" placeholder="Input KP">
            <input type="submit" value="Submit">
          </form>
          <p>KI</p>
          <form action="/get">
            <input type="number" name="In_kiFan4" step="0.00001" placeholder="Input KI">
            <input type="submit" value="Submit">
          </form>
          <p>KD</p>
          <form action="/get">
            <input type="number" name="In_kdFan4" step="0.00001" placeholder="Input KD">
            <input type="submit" value="Submit">
          </form>
          <p>Nilai KP = <span id="kpFan4">1.00000</span>, Nilai KI = <span id="kiFan4">0.00000</span>, Nilai KD = <span id="kdFan4">0.00000</span></p>
        </div> -->
    
        
      </div>
      
      

      <div class="control-section">
        <p><b>Reset SD Card</b></p>
        <button onclick="confirmResetSD()">Reset SD Card</button>
      </div>

      <div class="control-section">
        <p><b>Menu Monitoring</b></p>
        <button onclick="window.location.href='/'">Ke Halaman Monitoring</button>
      </div>

      <div class="control-section">
        <p><b>Setting MAC Address</b></p>
        <button onclick="window.location.href='/MAC'">Ke Settingan MAC Address</button>
      </div>
      
    </div>
  </main>

  <footer>
    &copy; 2025 | Sistem Monitoring Tunnel ESP32
  </footer>

  <!-- JavaScript -->
  <script>

    var chartTemperature = new Highcharts.Chart({
      chart: {
        renderTo: 'chart-Temperature',
        zoomType: 'xy'
      },
      title: { 
        text: 'Monitoring Temperature Tunnel'
      },
      data: {
        googleAPIKey: 'AIzaSyBpVYbHwcN1eTaR0E3_Tx9sW7WOv7GPhz8',
        googleSpreadsheetKey: '1BNeF6kAvrh-pzZekFypiugNuggv7tBsglAP16qDk9OQ',
        endColumn: 15,
        parsed: function(data) {
          let i = 0;
          let j = 0;
          let deleted = 0;
          let STARTCOLUMN = 1;
          let ENDCOLUMN = 15;
          data.forEach(column => {
            if (i == 0) {
              data[j] = data[i];
              j++;
            } else if ((i >= STARTCOLUMN) && (i <= ENDCOLUMN)) {
              data[j] = data[i];
              j++;
            } else {
              delete data[i];
              deleted++;
            }
            i++;
          });
          data.length -= deleted;
        },
      },
      tooltip: {
        animation: true,
        borderRadius: 25,
        shared: true,
      },
      plotOptions: {
        line: { 
          animation: false,
          dataLabels: { enabled: false }
        },
      },
      colors: [
        '#007bff', // biru
        '#00bcd4', // cyan
        '#009688', // teal
        '#4caf50', // hijau
        '#8bc34a', // hijau muda
        '#cddc39', // lime
        '#ffeb3b', // kuning
        '#ffc107', // amber
        '#ff9800', // oranye
        '#ff5722', // oranye tua
        '#f44336', // merah
        '#e91e63', // pink
        '#9c27b0', // ungu
        '#673ab7', // ungu tua
        '#3f51b5'  // biru keunguan
      ],
      xAxis: { 
        type: 'datetime',
        dateTimeLabelFormats: { second: '%H:%M:%S' },
        style: { color: '#000000' },
        crosshair: true,
      },
      yAxis: { 
        labels: {
          format: '{value} °C',
          style: { color: '#000000' }
        },
        title: {
          text: 'Temperature (°C)',
          style: { color: '#000000' }
        }
      },
      credits: { enabled: false }
    });

    var chartPID = new Highcharts.Chart({
      chart:{
        renderTo : 'chart-PID',
        zoomType : 'xy'
      },
      title: { text: 'Monitoring PID Tunnel'
      },
      data: {
            // googleAPIKey: 'AIzaSyBONp2_SP4-qJIsP5hqV6Qg6WGv9Jnf9Ro',
            // googleSpreadsheetKey: '12N7-LcxSufxSMqyTxYcm7PJx6BHC_ugz5wIz_SxclbA'
            googleAPIKey: 'AIzaSyBpVYbHwcN1eTaR0E3_Tx9sW7WOv7GPhz8',
            googleSpreadsheetKey: '1BNeF6kAvrh-pzZekFypiugNuggv7tBsglAP16qDk9OQ',
            endColumn:38,
            parsed:function(data) {
              let i=0;
              let j=0;
              let deleted=0;
              let STARTCOLUMN=36;
              let ENDCOLUMN=38;
              data.forEach(column => {
                // console.log(i)
                if (i==0) {
                  data[j]=data[i]
                  j++
                  // console.log("i==0");
                } else if ((i>=STARTCOLUMN)&&(i<=ENDCOLUMN)) {
                  data[j]=data[i]
                  j++
                  // console.log("else if ((i>=STARTCOLUMN)&&(i<=ENDCOLUMN)");
                } else {
                  delete data[i]
                  deleted++
                  // console.log("else");
                }
                i++;
              })
              data.length-=deleted
              // console.log(data.length)
            },
        },
      tooltip: {
        animation: true,
        borderRadius: 25,
        shared: true,
      },
      plotOptions: {
        line: { animation: false,
          dataLabels: { enabled: false }
        },
        // series: { color: '#059e8a' }
      },
      colors: [
        '#007bff', // biru
        '#00bcd4', // cyan
        '#009688', // teal
        '#4caf50', // hijau
        '#8bc34a', // hijau muda
        '#cddc39', // lime
        '#ffeb3b', // kuning
        '#ffc107', // amber
        '#ff9800', // oranye
        '#ff5722', // oranye tua
        '#f44336', // merah
        '#e91e63', // pink
        '#9c27b0', // ungu
        '#673ab7', // ungu tua
        '#3f51b5'  // biru keunguan
      ],
      xAxis: { type: 'datetime',
        dateTimeLabelFormats: { second: '%H:%M:%S' },
        style: {
                  color: '#000000',
                },
        crosshair: true,
      },
      yAxis: { // Primary yAxis
            labels: {
                format: '{value}',
                style: {
                    color: '#000000',
                }
            },
            title: {
                text: 'Ouput PWM',
                style: {
                    color: '#000000',
                }
            }
        },
      credits: { enabled: false }
    });


    async function fetchData() {
      try {
        const res = await fetch('/data');
        const data = await res.json();
        // const x = Date.now();
        const y = data.temperature;
        const x = data.time;
        
        // chart2.series[0].addPoint([x, data.Dsuhu1], true, chart2.series[0].data.length > 30);
        // chart2.series[1].addPoint([x, data.Dsuhu2], true, chart2.series[1].data.length > 30);
        // chart2.series[2].addPoint([x, data.Dsuhu3], true, chart2.series[2].data.length > 30);

        // chart2.series[0].addPoint([x, data.Dsuhu1]);
        // chart2.series[1].addPoint([x, data.Dsuhu2]);
        // chart2.series[2].addPoint([x, data.Dsuhu3]);

        chartPID.series[0].addPoint([x, Pulse_PID1]);
        chartPID.series[1].addPoint([x, Pulse_PID2]);
        chartPID.series[2].addPoint([x, Pulse_PID3]);


        // chart1.series[0].addPoint([x, data.BME1]);
        // chart1.series[1].addPoint([x, data.BME2]);
        // chart1.series[2].addPoint([x, data.BME3]);


        chartTemperature.series[0].addPoint([x, data.Usuhu1]);
        chartTemperature.series[1].addPoint([x, data.Usuhu2]);
        chartTemperature.series[2].addPoint([x, data.suhu1]);
        chartTemperature.series[3].addPoint([x, data.suhu2]);
        chartTemperature.series[4].addPoint([x, data.suhu3]);
        chartTemperature.series[5].addPoint([x, data.suhu4]);
        chartTemperature.series[6].addPoint([x, data.suhu5]);
        chartTemperature.series[7].addPoint([x, data.suhu6]);
        chartTemperature.series[8].addPoint([x, data.suhu7]);

        chartTemperature.series[9].addPoint([x, data.Dsuhu1]);
        chartTemperature.series[10].addPoint([x, data.Dsuhu2]);
        chartTemperature.series[11].addPoint([x, data.Dsuhu3]);

        chartTemperature.series[12].addPoint([x, data.Psuhu1]);
        chartTemperature.series[13].addPoint([x, data.Psuhu2]);
        chartTemperature.series[14].addPoint([x, data.Psuhu3]);

        // Jika data.suhu adalah array

      } catch (error) {
        console.error('Gagal mengambil data:', error);
      }
    }

    setInterval(fetchData, 5000);
    function confirmResetSD() {
      if (confirm("Apakah Anda yakin ingin mereset SD Card? Semua data akan hilang!")) {
        // Kirim request ke server untuk reset SD Card
        fetch('/resetSD')
          .then(res => {
            if (res.ok) {
              alert("SD Card berhasil direset.");
            } else {
              alert("Gagal mereset SD Card.");
            }
          })
          .catch(err => {
            alert("Terjadi kesalahan: " + err);
          });
      } else {
        alert("Reset SD Card dibatalkan.");
      }
    }

    let WCS_state1 = 1;
    let WCS_state2 = 1;
    let WCS_state3 = 1;

    let Pulse_PID1 = 1;
    let Pulse_PID2 = 1;
    let Pulse_PID3 = 1;    

    // Ambil data settingan realtime
    setInterval(function () {
      const xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          const data = this.responseText.split(',');
          
          document.getElementById("Suhu_Tunnel1").innerHTML = data[0];

          document.getElementById("Power_Tunnel1").innerHTML = data[1];

          document.getElementById("Heat_st1").innerHTML = (data[2] === "1") ? "ON" : "OFF";

          document.getElementById("Fan_Power1").innerHTML = (data[3] === "1") ? "MAX" : "OFF";

          
          document.getElementById("Suhu_Tunnel2").innerHTML = data[4];

          document.getElementById("Power_Tunnel2").innerHTML = data[5];

          document.getElementById("Heat_st2").innerHTML = (data[6] === "1") ? "ON" : "OFF";

          document.getElementById("Fan_Power2").innerHTML = (data[7] === "1") ? "MAX" : "OFF";


          document.getElementById("Suhu_Tunnel3").innerHTML = data[8];

          document.getElementById("Power_Tunnel3").innerHTML = data[9];

          document.getElementById("Heat_st3").innerHTML = (data[10] === "1") ? "ON" : "OFF";

          document.getElementById("Fan_Power3").innerHTML = (data[11] === "1") ? "MAX" : "OFF";

          document.getElementById("CalM_DinD1").innerHTML = parseFloat(data[12]).toFixed(5);
          document.getElementById("CalB_DinD1").innerHTML = parseFloat(data[13]).toFixed(5);

          document.getElementById("CalM_DinD2").innerHTML = parseFloat(data[14]).toFixed(5);
          document.getElementById("CalB_DinD2").innerHTML = parseFloat(data[15]).toFixed(5);

          document.getElementById("CalM_DinD3").innerHTML = parseFloat(data[16]).toFixed(5);
          document.getElementById("CalB_DinD3").innerHTML = parseFloat(data[17]).toFixed(5);

          document.getElementById("DindSuhu1").innerHTML = parseFloat(data[18]).toFixed(2);
          document.getElementById("DindSuhu2").innerHTML = parseFloat(data[19]).toFixed(2);
          document.getElementById("DindSuhu3").innerHTML = parseFloat(data[20]).toFixed(2);

          WCS_state1 = parseInt(data[21]);
          WCS_state2 = parseInt(data[22]);
          WCS_state3 = parseInt(data[23]);

          
          document.getElementById("SetPointSpan1").innerHTML = data[24];
          document.getElementById("SetPointSpan2").innerHTML = data[25];
          document.getElementById("SetPointSpan3").innerHTML = data[26];
          
          document.getElementById("Nilai_KP1").innerHTML = data[27];
          document.getElementById("Nilai_KP2").innerHTML = data[28];
          document.getElementById("Nilai_KP3").innerHTML = data[29];
          
          document.getElementById("Nilai_KI1").innerHTML = data[30];
          document.getElementById("Nilai_KI2").innerHTML = data[31];
          document.getElementById("Nilai_KI3").innerHTML = data[32];
          
          document.getElementById("Nilai_KD1").innerHTML = data[33];
          document.getElementById("Nilai_KD2").innerHTML = data[34];
          document.getElementById("Nilai_KD3").innerHTML = data[35];
          
          Pulse_PID1 = parseFloat(data[36]);
          Pulse_PID2 = parseFloat(data[37]);
          Pulse_PID3 = parseFloat(data[38]);
          
          document.getElementById("Max_Power_Tunnel1").innerHTML = data[36];
          document.getElementById("Max_Power_Tunnel2").innerHTML = data[37];
          document.getElementById("Max_Power_Tunnel3").innerHTML = data[38];

          document.getElementById("Nilai_PID1").innerHTML = data[39];
          document.getElementById("Nilai_PID2").innerHTML = data[40];
          document.getElementById("Nilai_PID3").innerHTML = data[41];

          // document.getElementById("Max_Power_Tunnel1").innerHTML = data[42];
          // document.getElementById("Max_Power_Tunnel2").innerHTML = data[43];
          // document.getElementById("Max_Power_Tunnel3").innerHTML = data[44];

          document.getElementById("Max_PID_Tunnel1").innerHTML = data[42];
          document.getElementById("Max_PID_Tunnel2").innerHTML = data[43];
          document.getElementById("Max_PID_Tunnel3").innerHTML = data[44];

          document.getElementById("CalM_Wcs1").innerHTML = parseFloat(data[45]).toFixed(5);
          document.getElementById("CalB_Wcs1").innerHTML = parseFloat(data[46]).toFixed(5);

          document.getElementById("CalM_Wcs2").innerHTML = parseFloat(data[47]).toFixed(5);
          document.getElementById("CalB_Wcs2").innerHTML = parseFloat(data[48]).toFixed(5);

          // document.getElementById("CalM_Wcs3").innerHTML = parseFloat(data[49]).toFixed(5);
          // document.getElementById("CalB_Wcs3").innerHTML = parseFloat(data[50]).toFixed(5);

          document.getElementById("kpFan1").innerHTML = parseFloat(data[51]).toFixed(5);
          document.getElementById("kiFan1").innerHTML = parseFloat(data[52]).toFixed(5);
          document.getElementById("kdFan1").innerHTML = parseFloat(data[53]).toFixed(5);

          document.getElementById("kpFan2").innerHTML = parseFloat(data[54]).toFixed(5);
          document.getElementById("kiFan2").innerHTML = parseFloat(data[55]).toFixed(5);
          document.getElementById("kdFan2").innerHTML = parseFloat(data[56]).toFixed(5);

          
          // Update status fan di HTML (cek apakah elemennya ada)
          const fan1 = document.getElementById("Fan_Status1");
          if (fan1) fan1.innerHTML = (WCS_state1 === 1) ? "Mati" : "Hidup";

          const fan2 = document.getElementById("Fan_Status2");
          if (fan2) fan2.innerHTML = (WCS_state2 === 1) ? "Mati" : "Hidup";

          const fan3 = document.getElementById("Fan_Status3");
          if (fan3) fan3.innerHTML = (WCS_state3 === 1) ? "Mati" : "Hidup";

          const targetSuhu = parseFloat(data[24]);

          if (!isNaN(targetSuhu)) {
            // chart2.yAxis[0].removePlotLine('target-line'); // hapus garis lama
            // chart2.yAxis[0].addPlotLine({
            //   id: 'target-line',
            //   value: targetSuhu,
            //   color: 'red',
            //   dashStyle: 'Dash',
            //   width: 2,
            //   label: {
            //     text: 'Target ' + targetSuhu + '°C',
            //     align: 'right',
            //     x: -10,
            //     style: { color: 'red', fontWeight: 'bold' }
            //   }
            // });

            chartTemperature.yAxis[0].removePlotLine('target-line'); // hapus garis lama
            chartTemperature.yAxis[0].addPlotLine({
              id: 'target-line',
              value: targetSuhu,
              color: 'red',
              dashStyle: 'Dash',
              width: 2,
              label: {
                text: 'Target ' + targetSuhu + '°C',
                align: 'right',
                x: -10,
                style: { color: 'red', fontWeight: 'bold' }
              }
            });
          }

        }
      };
      xhttp.open("GET", "/dataSetHeat", true);
      xhttp.send();
    }, 1000);

    function updateServer() {
      const xhttp = new XMLHttpRequest();
      xhttp.open("GET", "/updateServer", true);
      xhttp.send();
    }

    document.addEventListener('DOMContentLoaded', function () {
    // Daftar input suhu yang ingin dicek
    const tunnelInputs = [
        "In_Suhu_Tunnel1",
        "In_Suhu_Tunnel2",
        "In_Suhu_Tunnel3"
    ];

    tunnelInputs.forEach((inputName, index) => {
        const form = document.querySelector(`form[action="/get"] input[name="${inputName}"]`)?.closest('form');

        if (form) {
            form.addEventListener('submit', function (e) {
                if (WCS_state === 1) {
                    e.preventDefault(); // Hentikan submit
                    alert(`Fan pada Tunnel ${index + 1} dalam keadaan MATI! Tidak bisa set power heater.`);
                }
            });
        }
    });
});

  </script>
</body>
</html>